-- LocalScript in StarterPlayerScripts

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()
local Camera = workspace.CurrentCamera
local HighlightFolder = Instance.new("Folder", workspace)
HighlightFolder.Name = "Highlights"

local aimAssistEnabled = true -- Aim assist on/off
local assistStrength = 100 -- Strong aim assist
local updateRate = 0.1 -- Update every 0.1 seconds (reduce lag)
local lastUpdateTime = 0

-- Create a Highlight object for a player
local function createHighlight(character)
    local highlight = Instance.new("Highlight")
    highlight.Parent = HighlightFolder
    highlight.Adornee = character
    highlight.FillColor = Color3.fromRGB(255, 0, 0) -- Red color
    highlight.OutlineColor = Color3.fromRGB(255, 255, 255) -- White outline
    highlight.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop -- Visible through walls
    return highlight
end

-- Clean up old highlights to prevent lag
local function cleanupHighlights()
    for _, highlight in pairs(HighlightFolder:GetChildren()) do
        if not highlight.Adornee or not highlight.Adornee:IsDescendantOf(workspace) then
            highlight:Destroy()
        end
    end
end

-- Get the closest player
local function getClosestPlayer()
    local closestDistance = math.huge
    local closestPlayer = nil
    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            local distance = (LocalPlayer.Character.HumanoidRootPart.Position - player.Character.HumanoidRootPart.Position).Magnitude
            if distance < closestDistance then
                closestDistance = distance
                closestPlayer = player
            end
        end
    end
    return closestPlayer
end

-- Apply aim assist by nudging the aim towards the closest player
local function applyAimAssist(closestPlayer)
    if closestPlayer and closestPlayer.Character and closestPlayer.Character:FindFirstChild("HumanoidRootPart") then
        local targetPosition = closestPlayer.Character.HumanoidRootPart.Position
        local screenPoint = Camera:WorldToScreenPoint(targetPosition)
        local mousePosition = Vector2.new(Mouse.X, Mouse.Y)
        local aimDirection = (Vector2.new(screenPoint.X, screenPoint.Y) - mousePosition).unit

        -- Strong aim assist (snapping to target)
        Mousemoverel(aimDirection.X * assistStrength, aimDirection.Y * assistStrength)
    end
end

-- Main loop for highlighting and aim assist
RunService.RenderStepped:Connect(function(deltaTime)
    -- Throttle updates to reduce lag
    lastUpdateTime = lastUpdateTime + deltaTime
    if lastUpdateTime >= updateRate then
        lastUpdateTime = 0
        
        -- Clean up unused highlights
        cleanupHighlights()
        
        -- Find the closest player and apply highlight
        local closestPlayer = getClosestPlayer()
        if closestPlayer and closestPlayer.Character then
            -- Create a highlight for the closest player
            if not HighlightFolder:FindFirstChild(closestPlayer.Name) then
                createHighlight(closestPlayer.Character).Name = closestPlayer.Name
            end
            
            -- Apply aim assist if enabled
            if aimAssistEnabled then
                applyAimAssist(closestPlayer)
            end
        end
    end
end)
